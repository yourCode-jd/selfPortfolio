<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- favicon -->
    <link rel="icon" type="image/x-icon" href="assets/images/favIcon.png">

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Google Fonts: Rajdhani -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;500;600;700&display=swap" rel="stylesheet" />

    <link rel="stylesheet" href="style.css" />
    <title>Github | Projects</title>
</head>

<body class="">
    <main class="max-w-screen-2xl mx-auto px-5 md:px-8 lg:px-12">
        <header class="mb-6">
            <h1 class="text-3xl font-semibold">Projects</h1>
            <p class="text-white mt-1">Loaded from <code>projects.json</code> — click any card to view screenshots.
            </p>
        </header>

        <!-- container where projects render -->
        <section id="cardsGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6"></section>
    </main>

    <!-- modal gallery -->
    <div id="modal" class="fixed inset-0 z-50 hidden items-center justify-center px-4">
        <div class="absolute inset-0 bg-black/50" onclick="closeModal()"></div>

        <div class="relative bg-white rounded-2xl shadow-lg max-w-4xl w-full mx-auto overflow-hidden">
            <button aria-label="Close" onclick="closeModal()"
                class="absolute top-3 right-3 text-white text-lg z-20">✕</button>

            <div class="p-6">
                <h3 id="modalTitle" class="text-xl font-semibold mb-3"></h3>

                <div class="mb-4">
                    <img id="modalMainImg" src="" alt=""
                        class="w-full h-72 md:h-96 object-contain bg-gray-50 rounded" />
                </div>

                <div id="thumbs" class="flex gap-3 overflow-x-auto pb-1"></div>

                <div class="mt-4 flex gap-3">
                    <a id="repoLink" class="px-3 py-2 border rounded inline-block" target="_blank" rel="noopener">Open
                        on GitHub</a>
                    <button id="prevBtn" class="px-3 py-2 border rounded">Prev</button>
                    <button id="nextBtn" class="px-3 py-2 border rounded">Next</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ---------- helpers ----------
        function makePinUrl(user, repo, theme = "transparent") {
            const url = new URL("https://github-readme-stats.vercel.app/api/pin/");
            url.searchParams.set("username", user);
            url.searchParams.set("repo", repo);
            url.searchParams.set("theme", theme);
            return url.toString();
        }
        function escapeHtml(s) { if (!s) return ""; return String(s).replace(/[&<>"']/g, m => ({ '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;' })[m]); }

        // ---------- load projects.json ----------
        async function loadProjects() {
            try {
                const res = await fetch("/projects.json");
                if (!res.ok) throw new Error("Failed to fetch projects.json");
                const projects = await res.json();
                renderProjects(projects);
            } catch (err) {
                console.error(err);
                document.getElementById("cardsGrid").innerHTML = `<div class="col-span-full text-red-600">Error loading projects.json</div>`;
            }
        }

        // ---------- render ----------
        function renderProjects(list) {
            const grid = document.getElementById("cardsGrid");
            grid.innerHTML = list.map((p, i) => {
                const pin = makePinUrl(p.user, p.repo);
                const preview = (p.screenshots && p.screenshots.length) ? p.screenshots[0] : "";
                return `
          <article class="bg-white rounded-2xl p-4 shadow hover:shadow-lg transition cursor-pointer" data-idx="${i}" tabindex="0" aria-label="${escapeHtml(p.title || p.repo)}">
            <a href="https://github.com/${escapeHtml(p.user)}/${escapeHtml(p.repo)}" target="_blank" rel="noopener noreferrer" class="block mb-3" onclick="event.stopPropagation()">
              <img src="${pin}" alt="${escapeHtml(p.user)}/${escapeHtml(p.repo)}" class="w-full rounded-md hidden" loading="lazy" />
            </a>

            <div class="h-60 rounded-lg overflow-hidden bg-gray-100 mb-3 flex items-center justify-center">
              ${preview ? `<img src="${preview}" alt="${escapeHtml(p.title || p.repo)} screenshot" class="w-full h-full object-contain" loading="lazy" />` : `<div class="text-gray-400">No Screenshot</div>`}
            </div>

            <h3 class="font-semibold text-lg text-[#333333] mb-2">${escapeHtml(p.title || p.repo)}</h3>
            <p class="text-sm text-gray-500 mb-2">${escapeHtml(p.description || "")}</p>

            <div class="flex flex-wrap gap-2 text-base mt-4 text-[#555555]">
              ${(p.tags || []).map(t => `<span class="px-2 py-1 bg-gray-100 rounded-md">${escapeHtml(t)}</span>`).join("")}
            </div>
          </article>
        `;
            }).join("");

            // attach click handlers for modal
            grid.querySelectorAll("article[data-idx]").forEach(el => {
                el.addEventListener("click", () => {
                    const idx = Number(el.getAttribute("data-idx"));
                    openModalFromProjects(list, idx);
                });
                el.addEventListener("keydown", (e) => {
                    if (e.key === "Enter" || e.key === " ") {
                        e.preventDefault();
                        const idx = Number(el.getAttribute("data-idx"));
                        openModalFromProjects(list, idx);
                    }
                });
            });
        }

        // ---------- modal gallery ----------
        let activeProject = null;
        let activeImageIndex = 0;
        const modalEl = document.getElementById("modal");
        const modalTitle = document.getElementById("modalTitle");
        let modalMainImg = document.getElementById("modalMainImg");
        const thumbs = document.getElementById("thumbs");
        const repoLink = document.getElementById("repoLink");
        const prevBtn = document.getElementById("prevBtn");
        const nextBtn = document.getElementById("nextBtn");

        function openModalFromProjects(projects, idx) {
            const proj = projects[idx];
            if (!proj) return;
            activeProject = proj;
            activeImageIndex = 0;
            modalTitle.textContent = proj.title || (proj.user + "/" + proj.repo);
            repoLink.href = `https://github.com/${proj.user}/${proj.repo}`;
            renderModalImages(proj.screenshots || []);
            modalEl.classList.remove("hidden"); modalEl.classList.add("flex");
            document.body.style.overflow = "hidden";
        }

        function closeModal() {
            modalEl.classList.add("hidden"); modalEl.classList.remove("flex");
            document.body.style.overflow = "";
            activeProject = null; activeImageIndex = 0;
        }

        function renderModalImages(images) {
            if (!images || images.length === 0) {
                // show placeholder text and disable nav
                modalMainImg.src = "";
                modalMainImg.alt = "No screenshots";
                modalMainImg.parentElement.innerHTML = `<div class="mb-4 text-gray-500">No screenshots available for this project.</div>`;
                thumbs.innerHTML = "";
                prevBtn.disabled = true; nextBtn.disabled = true;
                return;
            }

            // replace main image element (safe re-render)
            modalMainImg.parentElement.innerHTML = `<img id="modalMainImg" src="${images[0]}" alt="${images[0]}" class="w-full h-72 md:h-96 object-contain bg-gray-50 rounded" />`;
            modalMainImg = document.getElementById("modalMainImg");

            thumbs.innerHTML = images.map((img, i) => `<img src="${img}" data-index="${i}" class="w-20 h-12 object-cover rounded cursor-pointer border" loading="lazy" />`).join("");
            updateActiveThumb(0);
            prevBtn.disabled = images.length <= 1;
            nextBtn.disabled = images.length <= 1;

            thumbs.querySelectorAll("img[data-index]").forEach(t => {
                t.addEventListener("click", () => { setActiveImage(Number(t.getAttribute("data-index"))); });
            });
        }

        function setActiveImage(i) {
            const imgs = activeProject?.screenshots || [];
            if (!imgs.length) return;
            if (i < 0) i = 0;
            if (i >= imgs.length) i = imgs.length - 1;
            activeImageIndex = i;
            const main = document.getElementById("modalMainImg");
            if (main) { main.src = imgs[i]; main.alt = imgs[i]; }
            updateActiveThumb(i);
        }

        function updateActiveThumb(i) {
            thumbs.querySelectorAll("img").forEach(el => el.classList.remove("thumb-active"));
            const active = thumbs.querySelector(`img[data-index='${i}']`);
            if (active) { active.classList.add("thumb-active"); active.scrollIntoView({ inline: "center", behavior: "smooth", block: "nearest" }); }
        }

        prevBtn.addEventListener("click", () => setActiveImage(activeImageIndex - 1));
        nextBtn.addEventListener("click", () => setActiveImage(activeImageIndex + 1));

        // keyboard nav
        window.addEventListener("keydown", (e) => {
            if (e.key === "Escape") closeModal();
            if (activeProject && e.key === "ArrowLeft") setActiveImage(activeImageIndex - 1);
            if (activeProject && e.key === "ArrowRight") setActiveImage(activeImageIndex + 1);
        });

        // prevent clicks inside modal content from closing
        document.querySelectorAll("#modal > div > div").forEach(node => node.addEventListener("click", e => e.stopPropagation()));

        // ---------- start ----------
        loadProjects();
    </script>

    <!-- GSAP -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/ScrollTrigger.min.js"></script>
    <script src="https://unpkg.com/split-type"></script>
    <script src="https://unpkg.com/gsap@3/dist/MotionPathPlugin.min.js"></script>
    <script src="custom.js"></script>
</body>

</html>